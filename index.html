<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Fondo marino nostálgico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Sugerencias anti-caché -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background:
        radial-gradient(circle at 10% 0%, #3f7f82 0%, #0b3a3e 35%, #020e10 80%),
        linear-gradient(to bottom, #083234, #020b0d);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .sea-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;

      /* Entrada elegante */
      opacity: 0;
      transform: translateY(8px);
      transition:
        opacity 0.7s ease-out,
        transform 0.7s ease-out;
    }

    .sea-container.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ---------------------------------
       ALGAS
       --------------------------------- */
    .alga {
      position: absolute;
      object-fit: cover;
      pointer-events: none;
      transform-origin: 50% 100%; /* ancladas abajo */
      will-change: transform;
    }

    /* Fondo — desenfocadas, más suaves */
    .alga-bg {
      z-index: 0;
      filter: blur(2px) saturate(0.8);
    }

    /* Frente — con movimiento de corriente */
    .alga-fg {
      z-index: 2;
      animation: corrienteSuave 10s ease-in-out infinite;
    }

    @keyframes corrienteSuave {
      0%   { transform: translateY(0px) skewX(0deg); }
      25%  { transform: translateY(-6px) skewX(1.5deg); }
      50%  { transform: translateY(-10px) skewX(3deg); }
      75%  { transform: translateY(-6px) skewX(1.5deg); }
      100% { transform: translateY(0px) skewX(0deg); }
    }

    /* ---------------------------------
       PARTÍCULAS EN EL AGUA
       --------------------------------- */
    .particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 3; /* sobre algas, bajo overlay */
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 999px;
      background: rgba(230, 245, 255, 0.8);
      mix-blend-mode: screen;
      opacity: 0.2;
      animation-name: floatParticle;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      will-change: transform, opacity;
    }

    @keyframes floatParticle {
      0% {
        transform: translate3d(0, 0, 0);
        opacity: 0;
      }
      10% {
        opacity: 0.25;
      }
      90% {
        opacity: 0.25;
      }
      100% {
        transform: translate3d(var(--dx, 0px), -120vh, 0);
        opacity: 0;
      }
    }

    /* Overlay suave (sin grain pesado) */
    .overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 50% 15%, rgba(255,255,220,0.08) 0, transparent 55%),
        linear-gradient(to bottom, rgba(10,35,45,0.45), rgba(0,0,0,0.7));
      mix-blend-mode: soft-light;
      z-index: 4;
    }
  </style>
</head>

<body>
  <div class="sea-container" id="sea-container">
    <!-- Partículas flotando en el agua -->
    <div class="particles" id="particles-layer"></div>

    <div class="overlay"></div>
  </div>

  <!-- ------------------------------------
       JAVASCRIPT
       ------------------------------------ -->
  <script>
    const algaeSources = [
      "algas/algas 1.png",
      "algas/algas 2.png",
      "algas/algas 3.png",
      "algas/algas 4.png",
      "algas/algas 5.png"
    ];

    const container = document.getElementById("sea-container");
    const particlesContainer = document.getElementById("particles-layer");

    let bgImages = [];
    let fgImages = [];

    // flags para entrada elegante
    let bgReady = false;
    let fgReady = false;
    let hasRevealed = false;

    function random(min, max) {
      return min + Math.random() * (max - min);
    }

    function resetRevealState() {
      bgReady = false;
      fgReady = false;
      hasRevealed = false;
      container.classList.remove("visible");
    }

    function tryRevealScene() {
      if (bgReady && fgReady && !hasRevealed) {
        hasRevealed = true;
        requestAnimationFrame(() => {
          container.classList.add("visible");
        });
      }
    }

    function createSea() {
      container.querySelectorAll("img.alga").forEach(img => img.remove());
      bgImages = [];
      fgImages = [];

      resetRevealState();
      createBackgroundAlgae();
      createForegroundAlgae();
    }

    /* ----- FONDO ----- */
    function createBackgroundAlgae() {
      const count = Math.floor(random(8, 14)); // un poco menos que antes
      let loaded = 0;

      for (let i = 0; i < count; i++) {
        const src = algaeSources[Math.floor(Math.random() * algaeSources.length)];
        const img = document.createElement("img");
        img.className = "alga alga-bg";
        img.src = src;

        img.style.opacity = random(0.25, 0.45).toFixed(2);

        if (Math.random() < 0.5) img.style.transform = "scaleX(-1)";

        img.onload = () => {
          loaded++;
          if (loaded === count) layoutBackgroundAlgae();
        };

        bgImages.push(img);
        container.insertBefore(img, container.firstChild);
      }
    }

    function layoutBackgroundAlgae() {
      if (!bgImages.length) return;

      const vh = window.innerHeight;
      const vw = window.innerWidth;

      const totalHeight = vh * 1.05;  // un poquito más que la pantalla
      const topOffset  = -vh * 0.05;  // subidas 5%

      let currentX = random(0.05 * vw, 0.1 * vw);

      bgImages.forEach(img => {
        const ratio = img.naturalWidth / img.naturalHeight || 0.4;

        let width = vh * ratio * 0.9;
        const maxWidth = vw * 0.35;
        if (width > maxWidth) width = maxWidth;

        if (currentX + width > vw - 0.05 * vw) {
          img.remove();
          return;
        }

        img.style.height = totalHeight + "px";
        img.style.width  = width + "px";
        img.style.top    = topOffset + "px";
        img.style.left   = currentX + "px";

        const gap = random(0.10 * vw, 0.20 * vw);
        currentX += width + gap;
      });

      bgReady = true;
      tryRevealScene();
    }

    /* ----- FRENTE ----- */
    function createForegroundAlgae() {
      const count = Math.floor(random(6, 10)); // menos para aligerar
      let loaded = 0;

      for (let i = 0; i < count; i++) {
        const src = algaeSources[Math.floor(Math.random() * algaeSources.length)];
        const img = document.createElement("img");
        img.className = "alga alga-fg";
        img.src = src;

        img.style.opacity = random(0.55, 0.8).toFixed(2);
        if (Math.random() < 0.5) img.style.transform = "scaleX(-1)";

        img.onload = () => {
          loaded++;
          if (loaded === count) layoutForegroundAlgae();
        };

        fgImages.push(img);
        container.insertBefore(img, container.querySelector(".overlay"));
      }
    }

    function layoutForegroundAlgae() {
      if (!fgImages.length) return;

      const vh = window.innerHeight;
      const vw = window.innerWidth;

      const segments = fgImages.length - 1 || 1;
      const segmentWidth = vw / segments;

      const totalHeight = vh * 1.05;
      const topOffset  = -vh * 0.05;

      fgImages.forEach((img, i) => {
        const ratio = img.naturalWidth / img.naturalHeight || 0.4;
        const width = vh * ratio * 1.0;

        const center = i * segmentWidth + random(-segmentWidth * 0.15, segmentWidth * 0.15);
        const left   = center - width / 2;

        img.style.height = totalHeight + "px";
        img.style.width  = width + "px";
        img.style.left   = left + "px";
        img.style.top    = topOffset + "px";
      });

      fgReady = true;
      tryRevealScene();
    }

    /* ----- PARTÍCULAS ----- */
    function createParticles() {
      if (!particlesContainer) return;

      particlesContainer.innerHTML = "";

      const count = 35; // menos partículas para iPad
      for (let i = 0; i < count; i++) {
        const p = document.createElement("div");
        p.className = "particle";

        const size = random(2, 4);
        p.style.width = size + "px";
        p.style.height = size + "px";

        const left = random(0, 100);
        const startY = random(0, 100);
        p.style.left = left + "vw";
        p.style.top = startY + "vh";

        const dx = random(-14, 14).toFixed(1) + "px";
        p.style.setProperty("--dx", dx);

        const dur = random(20, 40).toFixed(1) + "s";
        const delay = random(-40, 0).toFixed(1) + "s";

        p.style.animationDuration = dur;
        p.style.animationDelay = delay;
        p.style.opacity = random(0.1, 0.35).toFixed(2);

        particlesContainer.appendChild(p);
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      createSea();
      createParticles();
    });

    window.addEventListener("resize", () => {
      layoutBackgroundAlgae();
      layoutForegroundAlgae();
      createParticles();
    });
  </script>
</body>
</html>
