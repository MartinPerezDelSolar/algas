<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Fondo marino nostálgico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background:
        radial-gradient(circle at 10% 0%, #3f7f82 0%, #0b3a3e 35%, #020e10 80%),
        linear-gradient(to bottom, #083234, #020b0d);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .sea-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    /* ---------------------------------
       ALGAS
       --------------------------------- */
    .alga {
      position: absolute;
      object-fit: cover;
      pointer-events: none;
      transform-origin: 50% 100%; /* ancladas abajo */
    }

    /* Fondo — ahora con efecto de agua también */
    .alga-bg {
      z-index: 0;
    }

    /* Frente — con efecto de agua + puppet */
    .alga-fg {
      z-index: 2;
      height: 100vh;
      top: 0;
      filter: saturate(0.95) url(#agua-suave);
      animation: corrientePuppet 12s ease-in-out infinite;
    }

    /* Movimiento grupal de corriente */
    @keyframes corrientePuppet {
      0%   { transform: translateY(0px) rotate(0deg) skewX(0deg); }
      25%  { transform: translateY(-6px) rotate(0.5deg) skewX(1.5deg); }
      50%  { transform: translateY(-12px) rotate(1.2deg) skewX(3deg); }
      75%  { transform: translateY(-6px) rotate(0.4deg) skewX(1.5deg); }
      100% { transform: translateY(0px) rotate(0deg) skewX(0deg); }
    }

    /* ---------------------------------
       SUELO MARINO (dunas/colinas)
       --------------------------------- */
    .seabed {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 12vh;     /* 12% de la pantalla */
      z-index: 3;       /* tapa algas fondo y frente */
      pointer-events: none;
    }

    .seabed svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* ---------------------------------
       PARTÍCULAS EN EL AGUA
       --------------------------------- */
    .particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      z-index: 3; /* sobre algas y suelo, bajo overlay */
      overflow: hidden;
    }

    .particle {
      position: absolute;
      border-radius: 999px;
      background: rgba(230, 245, 255, 0.7);
      mix-blend-mode: screen;
      opacity: 0.25;
      animation-name: floatParticle;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      will-change: transform;
    }

    @keyframes floatParticle {
      0% {
        transform: translate3d(0, 0, 0);
      }
      100% {
        transform: translate3d(var(--dx, 0px), -120vh, 0);
      }
    }

    /* Overlay */
    .overlay {
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 50% 15%, rgba(255,255,220,0.08) 0, transparent 55%),
        linear-gradient(to bottom, rgba(10,35,45,0.50), rgba(0,0,0,0.75));
      mix-blend-mode: soft-light;
      z-index: 4; /* sobre suelo y partículas */
    }

    /* Grano */
    .grain {
      position: absolute;
      inset: 0;
      pointer-events: none;
      opacity: 0.16;
      mix-blend-mode: soft-light;
      z-index: 5; /* sobre overlay */
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.9'/%3E%3C/svg%3E");
    }
  </style>
</head>

<body>
  <div class="sea-container" id="sea-container">

    <!-- SUELO MARINO (capa superior a las algas, sin movimiento) -->
    <div class="seabed">
      <svg viewBox="0 0 100 20" preserveAspectRatio="none">
        <defs>
          <linearGradient id="seabedGrad" x1="0" y1="0" x2="0" y2="1">
            <!-- tonos más claros verdozo/gris/marrón -->
            <stop offset="0%"  stop-color="#6f8266"/>
            <stop offset="45%" stop-color="#5d6f5b"/>
            <stop offset="100%" stop-color="#495548"/>
          </linearGradient>
        </defs>

        <!-- Dunas suaves -->
        <path d="
          M0,20
          C 8,16 16,15 26,16
          C 36,17 46,14 56,15
          C 66,16 76,14 86,15
          C 93,16 97,17 100,16
          L100,20 Z"
          fill="url(#seabedGrad)"
        />
      </svg>
    </div>

    <!-- Partículas flotando en el agua -->
    <div class="particles" id="particles-layer"></div>

    <div class="overlay"></div>
    <div class="grain"></div>
  </div>

  <!-- --------------------------
       FILTRO DE AGUA
       -------------------------- -->
  <svg width="0" height="0" style="position:absolute">
    <defs>
      <filter id="agua-suave" x="-20%" y="-20%" width="140%" height="140%">
        <feTurbulence
            type="fractalNoise"
            baseFrequency="0.015 0.035"
            numOctaves="2"
            seed="4"
            result="noise">
          <animate attributeName="baseFrequency"
                   dur="14s"
                   values="0.015 0.035; 0.020 0.040; 0.015 0.035"
                   repeatCount="indefinite"/>
        </feTurbulence>

        <feDisplacementMap
            in="SourceGraphic"
            in2="noise"
            scale="2"
            xChannelSelector="R"
            yChannelSelector="G" />
      </filter>
    </defs>
  </svg>

  <!-- ------------------------------------
       JAVASCRIPT
       ------------------------------------ -->
  <script>
    const algaeSources = [
      "algas/algas 1.png",
      "algas/algas 2.png",
      "algas/algas 3.png",
      "algas/algas 4.png",
      "algas/algas 5.png"
    ];

    const container = document.getElementById("sea-container");
    const particlesContainer = document.getElementById("particles-layer");

    let bgImages = [];
    let fgImages = [];

    function random(min, max) {
      return min + Math.random() * (max - min);
    }

    function createSea() {
      container.querySelectorAll("img.alga").forEach(img => img.remove());
      bgImages = [];
      fgImages = [];

      createBackgroundAlgae();
      createForegroundAlgae();
    }

    /* ----- FONDO ----- */
    function createBackgroundAlgae() {
      // AUMENTAMOS cantidad de algas del fondo
      const count = Math.floor(random(10, 18));
      let loaded = 0;

      for (let i = 0; i < count; i++) {
        const src = algaeSources[Math.floor(Math.random() * algaeSources.length)];
        const img = document.createElement("img");
        img.className = "alga alga-bg";
        img.src = src;

        img.style.opacity = random(0.22, 0.40).toFixed(2);

        const blur = random(1.2, 3.2);
        // ahora también con efecto de agua
        img.style.filter = `blur(${blur.toFixed(1)}px) saturate(0.8) url(#agua-suave)`;

        if (Math.random() < 0.5) img.style.transform = "scaleX(-1)";

        img.onload = () => {
          loaded++;
          if (loaded === count) layoutBackgroundAlgae();
        };

        bgImages.push(img);
        container.insertBefore(img, container.firstChild);
      }
    }

    function layoutBackgroundAlgae() {
      if (!bgImages.length) return;

      const vh = window.innerHeight;
      const vw = window.innerWidth;
      const height = vh;

      let currentX = random(0.05 * vw, 0.1 * vw);

      bgImages.forEach(img => {
        const ratio = img.naturalWidth / img.naturalHeight || 0.4;

        let width = vh * ratio * 0.95;
        const maxWidth = vw * 0.35;
        if (width > maxWidth) width = maxWidth;

        if (currentX + width > vw - 0.05 * vw) {
          img.remove();
          return;
        }

        img.style.height = height + "px";
        img.style.width = width + "px";
        img.style.top = "0px";
        img.style.left = currentX + "px";

        const gap = random(0.10 * vw, 0.20 * vw);
        currentX += width + gap;
      });
    }

    /* ----- FRENTE ----- */
    function createForegroundAlgae() {
      // DISMINUIMOS un poco las algas delanteras
      const count = Math.floor(random(7, 12));
      let loaded = 0;

      for (let i = 0; i < count; i++) {
        const src = algaeSources[Math.floor(Math.random() * algaeSources.length)];
        const img = document.createElement("img");
        img.className = "alga alga-fg";
        img.src = src;

        img.style.opacity = random(0.50, 0.78).toFixed(2);
        if (Math.random() < 0.5) img.style.transform = "scaleX(-1)";

        img.onload = () => {
          loaded++;
          if (loaded === count) layoutForegroundAlgae();
        };

        fgImages.push(img);
        container.insertBefore(img, container.querySelector(".overlay"));
      }
    }

    function layoutForegroundAlgae() {
      if (!fgImages.length) return;

      const vh = window.innerHeight;
      const vw = window.innerWidth;

      const segments = fgImages.length - 1 || 1;
      const segmentWidth = vw / segments;

      fgImages.forEach((img, i) => {
        const ratio = img.naturalWidth / img.naturalHeight || 0.4;
        const width = vh * ratio * 1.08;

        const center = i * segmentWidth + random(-segmentWidth * 0.15, segmentWidth * 0.15);
        const left = center - width / 2;

        img.style.height = vh + "px";
        img.style.width = width + "px";
        img.style.left = left + "px";
        img.style.top = "0px";
      });
    }

    /* ----- PARTÍCULAS ----- */
    function createParticles() {
      if (!particlesContainer) return;

      particlesContainer.innerHTML = "";

      const count = 60;
      for (let i = 0; i < count; i++) {
        const p = document.createElement("div");
        p.className = "particle";

        const size = random(2, 5);
        p.style.width = size + "px";
        p.style.height = size + "px";

        const left = random(0, 100);
        const startY = random(0, 100);
        p.style.left = left + "vw";
        p.style.top = startY + "vh";

        const dx = random(-16, 16).toFixed(1) + "px";
        p.style.setProperty("--dx", dx);

        const dur = random(18, 36).toFixed(1) + "s";
        const delay = random(-36, 0).toFixed(1) + "s";

        p.style.animationDuration = dur;
        p.style.animationDelay = delay;
        p.style.opacity = random(0.12, 0.40).toFixed(2);

        particlesContainer.appendChild(p);
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      createSea();
      createParticles();
    });

    window.addEventListener("resize", () => {
      layoutBackgroundAlgae();
      layoutForegroundAlgae();
      createParticles();
    });
  </script>
</body>
</html>
